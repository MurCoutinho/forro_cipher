#define __test
#include <stdint.h>
#include <stdlib.h>
#include <time.h>
#include <sys/time.h>
#include <stdio.h>
#include "src/forro/x86-simd/forro.h"
#include "src/xote/x86-simd/xote.h"

void run_test_vectors(uint8_t key[32], uint8_t iv[8], uint32_t number_of_bytes)
{
    stream_ctx input;

    uint8_t *output_forro = (uint8_t *)malloc(number_of_bytes);
    uint8_t *output_xote = (uint8_t *)malloc(number_of_bytes);

    forro_keysetup(&input, key, 256, 64);
    forro_ivsetup(&input, iv);
    forro_keystream_bytes(&input, output_forro, number_of_bytes);

    xote_keysetup(&input, key, 256, 64);
    xote_ivsetup(&input, iv);
    xote_keystream_bytes(&input, output_xote, number_of_bytes);

    // Display the result to the screen

    printf("KEY:\n");
    for (int i = 0; i < 32; i++)
    {
        printf("%02x", key[i]);
        if (i % 16 == 15)
            printf("\n");
    }
    printf("\nNONCE:\n");
    for (int i = 0; i < 8; i++)
    {
        printf("%02x", iv[i]);
        if (i % 8 == 7)
            printf("\n");
    }
    printf("\nSTREAM:\n");
    printf("--------------------------------\t--------------------------------\n");
    printf("|             FORRO            |\t|             XOTE             |\n");
    printf("--------------------------------\t--------------------------------\n");
    for (int i = 0; i < 4; i++)
    {
        for (int k = 0; k < 16; k++)
            printf("%02x", output_forro[16 * i + k]);
        printf("\t");
        for (int k = 0; k < 16; k++)
            printf("%02x", output_xote[16 * i + k]);
        printf("\n");
    }
}

int main(int argc, char *argv[])
{
    uint64_t number_of_bytes = 128;
    // printf("Teste: All zero key and IV.\n");
    // printf("---------------------------\n");
    /*
            KEY:       00000000000000000000000000000000000000000000000000000000
                00000000
            */
    uint8_t key[32] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    /*
            NONCE:     0000000000000000
            */
    uint8_t iv[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    uint8_t count[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    run_test_vectors(key, iv, number_of_bytes);

    // printf("Teste: One key and zero IV.\n");
    // printf("---------------------------\n");
    /*
            KEY:       01000000000000000000000000000000000000000000000000000000
                    00000000
            */
    uint8_t key1[32] = {0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    /*
            NONCE:     0000000000000000
            */
    uint8_t iv1[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    uint8_t count1[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    run_test_vectors(key1, iv1, number_of_bytes);

    // printf("Teste: Zero key and one IV.\n");
    // printf("---------------------------\n");
    /*
            KEY:       00000000000000000000000000000000000000000000000000000000
                    00000000
            */
    uint8_t key2[32] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    /*
            NONCE:     0100000000000000
            */
    uint8_t iv2[8] = {0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    uint8_t count2[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    run_test_vectors(key2, iv2, number_of_bytes);

    // printf("Teste: FF key and FF IV.\n");
    // printf("---------------------------\n");

    uint8_t key3[32] = {0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                        0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                        0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
                        0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff};

    uint8_t iv3[8] = {0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff};
    uint8_t count3[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    run_test_vectors(key3, iv3, number_of_bytes);

    // printf("Teste: 55 key and 55 IV.\n");
    // printf("---------------------------\n");

    uint8_t key4[32] = {0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55,
                        0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55,
                        0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55,
                        0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55};

    uint8_t iv4[8] = {0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55};
    uint8_t count4[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    run_test_vectors(key4, iv4, number_of_bytes);

    // printf("Teste: AA key and AA IV.\n");
    // printf("---------------------------\n");

    uint8_t key5[32] = {0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
                        0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
                        0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
                        0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa};

    uint8_t iv5[8] = {0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa, 0xaa};
    uint8_t count5[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    run_test_vectors(key5, iv5, number_of_bytes);

    // printf("Teste: Counting key and IV.\n");
    // printf("---------------------------\n");

    uint8_t key6[32] = {0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77,
                        0x88, 0x99, 0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff,
                        0xff, 0xee, 0xdd, 0xcc, 0xbb, 0xaa, 0x99, 0x88,
                        0x77, 0x66, 0x55, 0x44, 0x33, 0x22, 0x11, 0x00};

    uint8_t iv6[8] = {0x0f, 0x1e, 0x2d, 0x3c, 0x4b, 0x5a, 0x69, 0x78};
    uint8_t count6[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    run_test_vectors(key6, iv6, number_of_bytes);

    // printf("Teste: C4 key and 1A IV.\n");
    // printf("---------------------------\n");

    uint8_t key7[32] = {0xc4, 0x6e, 0xc1, 0xb1, 0x8c, 0xe8, 0xa8, 0x78,
                        0x72, 0x5a, 0x37, 0xe7, 0x80, 0xdf, 0xb7, 0x35,
                        0x1f, 0x68, 0xed, 0x2e, 0x19, 0x4c, 0x79, 0xfb,
                        0xc6, 0xae, 0xbe, 0xe1, 0xa6, 0x67, 0x97, 0x5d};

    uint8_t iv7[8] = {0x1a, 0xda, 0x31, 0xd5, 0xcf, 0x68, 0x82, 0x21};
    uint8_t count7[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    run_test_vectors(key7, iv7, number_of_bytes);

    // printf("Teste: minha vida e andar.\n");
    // printf("---------------------------\n");

    uint8_t key8[32] = "minha vida e andar por este pais";

    uint8_t iv8[8] = "mostro a";
    uint8_t count8[8] = " alegria";
    run_test_vectors(key8, iv8, number_of_bytes);

    // printf("Teste: como se danca o baiao.\n");
    // printf("---------------------------\n");

    uint8_t key9[32] = "eu vou mostrar pra voces como se";

    uint8_t iv9[8] = "danca o ";
    uint8_t count9[8] = "baiao!!!";
    run_test_vectors(key9, iv9, number_of_bytes);

    return 0;
}
